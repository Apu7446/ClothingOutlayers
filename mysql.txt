CREATE DATABASE IF NOT EXISTS clothing_db
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;

USE clothing_db;

CREATE TABLE IF NOT EXISTS users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  email VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  phone VARCHAR(15),
  address TEXT,
  role ENUM('customer','admin','staff') DEFAULT 'customer',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS products (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(200) NOT NULL,
  description TEXT,
  price DECIMAL(10,2) NOT NULL,
  size VARCHAR(20),
  color VARCHAR(50),
  category VARCHAR(100),
  image VARCHAR(255),
  stock INT DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS cart (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  product_id INT NOT NULL,
  quantity INT DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_cart_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
  CONSTRAINT fk_cart_product FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
  UNIQUE KEY uniq_user_product (user_id, product_id)
);

CREATE TABLE IF NOT EXISTS orders (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL,
  total_amount DECIMAL(10,2) NOT NULL,
  status ENUM('pending','confirmed','shipped','delivered','cancelled') DEFAULT 'pending',
  shipping_address TEXT,
  payment_method VARCHAR(50),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_orders_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS order_items (
  id INT AUTO_INCREMENT PRIMARY KEY,
  order_id INT NOT NULL,
  product_id INT NOT NULL,
  quantity INT NOT NULL,
  price DECIMAL(10,2) NOT NULL,
  CONSTRAINT fk_orderitems_order FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
  CONSTRAINT fk_orderitems_product FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
);

-- Default admin (password plain "123456" রাখা হলো যাতে basic setup এ কাজ করে)
-- Login code first-time এ এটাকে auto-hash করে update করে দিবে।
INSERT INTO users (name, email, password, role)
VALUES ('Admin', 'admin@gmail.com', '123456', 'admin')
ON DUPLICATE KEY UPDATE email=email;

-- Sample products
INSERT INTO products (name, description, price, size, color, category, stock, image) VALUES
('T-Shirt', 'Cotton t-shirt for men', 500.00, 'M', 'Black', 'Men', 50, NULL),
('Jeans', 'Denim jeans for men', 1200.00, 'L', 'Blue', 'Men', 30, NULL),
('Saree', 'Silk saree for women', 2500.00, 'Free', 'Red', 'Women', 20, NULL),
('Kurti', 'Cotton kurti for women', 800.00, 'M', 'Yellow', 'Women', 40, NULL),
('Kids Dress', 'Frock for kids', 600.00, 'S', 'Pink', 'Kids', 25, NULL);